<div class="<%= visible ? 'year-column visible' : 'year-column hidden'%>" data-year="<%= year %>">
    <div class="year-header"><%= year %></div>
    <div class="competitions-list">
        <% results.reverse.each do |result| -%>
            <%
               dist  = result[:data]['Дистанция']
               time  = result[:data]['Время'].sub(/,\d+$/, '')
               pace         = result[:data]['Темп']
               title = result[:data]['Название']
               eid   = "#{year}-#{result[:id]}"
               date_str     = result[:data]['Дата']
               place        = result[:data]['Место']      # «64 / 481»
               category     = result[:data]['Категория']  # «11 / 89»
               strava_link  = result[:data]['Strava']     # «https://…»
               results_link = result[:data]['Results']    # «https://…»
            -%>
            <div class="competition-row" data-popup-id="popup-<%= eid %>">
                <%= distance_icon(dist) %><span class="time"><%= time %></span><span class="title"><%= title %></span>
            </div>
            <div class="popup" id="popup-<%= eid %>" style="display: none;">
              <div class="popup-backdrop"></div>
              <div class="popup-card">
                <button class="popup-close" data-popup-id="popup-<%= eid %>">&times;</button>

                <!-- Название соревнования -->
                <h3 class="event-name"><%= title %></h3>

                <!-- Основные параметры: двухколоночная сетка -->
                <div class="event-details">
                  <div class="detail-row">
                    <span class="label">Дата</span>
                    <span class="value"><%=  date_str %></span>
                  </div>
                  <div class="detail-row">
                    <span class="label">Дистанция</span>
                    <span class="value"><%= dist %></span>
                  </div>
                  <div class="detail-row">
                    <span class="label">Время</span>
                    <span class="value"><%= time %></span>
                  </div>
                  <div class="detail-row">
                    <span class="label">Темп</span>
                    <span class="value"><%= pace %></span>
                  </div>
                  <div class="detail-row">
                    <span class="label">Место</span>
                    <span class="value"><%= place %></span>
                  </div>
                  <div class="detail-row">
                    <span class="label">Категория</span>
                    <span class="value"><%= category %></span>
                  </div>
                </div>

                <!-- Ссылки: две кнопки/ссылки -->
                <div class="event-links">
                  <% if strava_link && !strava_link.empty? %>
                    <a href="<%= strava_link %>" class="link-button" target="_blank" rel="noopener">Strava</a>
                  <% end %>
                  <% if results_link && !results_link.empty? %>
                    <a href="<%= results_link %>" class="link-button" target="_blank" rel="noopener">Results</a>
                  <% end %>
                </div>
              </div>
            </div>
        <% end -%>
    </div>
</div>
